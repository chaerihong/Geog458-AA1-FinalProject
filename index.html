<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="description" content="Hospital Accessibility" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Hospital Accessibility</title>
  <link rel="icon" href="img/fav.png">
  <!-- <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Fira+Sans:ital,wght@0,400;0,500;1,400;1,500&display=swap" /> -->
  <!-- <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css"> -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"> -->
  <link rel="stylesheet" href="css/main.css">
  <script src="https://unpkg.com/scrollama"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
</head>

<body>
  <header>
    <nav>
      <ul>
        <img src="img/fav.png" alt="hospital" style="width: 30px; height: auto;">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
      </ul>
    </nav>
  </header>
  <!-- loading a video cover page -->
  <section id="cover">
    <!-- loading a video as the background -->
    <video class="fullscreen canvas-center" playsinline="" autoplay="" muted="" loop="">
      <source src="assets/intro.mp4" type="video/mp4">
    </video>
    <div id="intro">
      <h1>Hospital Accessibility</h1>
      <h5>"Having a local hospital or access to care is critical in an emergency situation where minutes can make a big difference... More than 100 (or 4% of) rural hospitals closed from 2013 through 2020. As a result, residents had to travel about 20 miles farther for common services like inpatient care..." - <a class="white-link" target="_blank" href="https://www.gao.gov/blog/why-health-care-harder-access-rural-america">U.S. Government Accountability Office</a></p>

      <div class="footnote">
        <a class="white-link" target="_blank" href="https://www.pexels.com/video/a-clean-office-building-3197808/">Video by Andrey Kirievskiy</a>
      </div>
    </div>
  </section>
  <!-- a geonarrative will have two major components, a storyboard and a script panel of a series of scenes/actions -->
  <section id="geonarrative">
    <!-- a storymap can present differnt types of objects, like map, chart, diagram, etc. -->
    <div id="storyboard">
      <!-- create the place holder element for map -->
      <div id="map"></div>
    </div>

    <article class="scene" data-scene="0">
      <h2>Hospitals in the US</h2>
      </div>
      <div style="display: flex; flex-direction: column; align-items: center;">
        <img class="img" src="img/aerial.jpg" style="width: 40%; height: auto; margin: 0 10px;">
      </div>
      </div>
      <figcaption>Image courtesy of <a href="https://news.med.virginia.edu/community/uva-health-riverside-health-system-form-new-strategic-alliance/attachment/hospital-aerial/">Medicine in Motion</a></figcaption>
    </article>
    <article class="scene" data-scene="1">
      <h2>Hospitals and County Population in WA </h2>
      <div class="middle-sum">
        <img class="img" src="img/hospital.jpg" style="width: 40%; height: auto; margin: 0 10px;">
        <img class="img" src="img/countylegend.png" style="width: 20%; height: auto; margin: 0 10px;"></img>
      </div>
      <figcaption>Images courtesy of <a href="https://www.va.gov/puget-sound-health-care/locations/seattle-va-medical-center/">US Department of Veteran's Affairs</a> and QGIS</figcaption>
    </article>
    <article class="scene" data-scene="2">
      <h2>Total Beds in Hospitals in WA</h2>
      <div class="middle-sum">
        <img class="img" src="img/bed.png" style="width: 40%; height: auto; margin: 0 10px;">
        <img class="img" src="img/bedslegend.png" style="width: 20%; height: auto; margin: 0 10px;"></img>
      </div>
      <figcaption>Images courtesy of <a href="https://www.modernhealthcare.com/hospitals/covid-19-could-fill-hospital-beds-how-many-are-there">Modern Healthcare</a> and QGIS</figcaption>
    </article>
    <article class="scene" data-scene="3">
      <h2>Hospital Accessibility for Minority Populations by Census Tract in Seattle, WA</h2>
      <div class="middle-sum">
        <img class="img" src="img/uwmed.jpg" style="width: 40%; height: auto; margin: 0 10px;">
        <img class="img" src="img/minoritylegend.png" style="width: 20%; height: auto; margin: 0 10px;">
      </div>
      <figcaption>Images courtesy of <a href="https://www.usa.skanska.com/4a532f/globalassets/externalcontent2/project/university-of-washington-medical-center-montlake-tower-expansion/ab603c15-f473-47cb-a54c-c5ba53b2558d.1.jpg?height=524&width=932&scale=both&mode=crop&bgcolor=">Skanska</a> and QGIS</figcaption>
      <p>Disparities in healthcare access are an important determinant of overall health outcomes, resulting in unequal access to healthcare for various populations and contributing to the measurable and observable effects or results healthcare services have on individuals and communities. Due to differences in accessibility in healthcare, equitable health outcomes cannot be reached as inequalities are at play. Here, we explore how the City of Seattle's hospitals are distributed along with the City's minority population by census tract to explore whether demographics impact healthcare accessibility. The analysis reveals that in Seattle there appears to be a relationship between hospital distributions and minority population suggesting that minority populations in the City of Seattle face challenges in accessing healthcare services, specifically hospitals, as there are spatial disparities based on demographics. The spatial distribution of hospitals in Seattle largely clusters in areas where fewer minorities reside, resulting in inequitable healthcare access to minority populations that lower their health outcomes.</p>

    </article>
    <article class="scene fullscreen" data-scene="4">
      <h2>Conclusion</h2>
    </article>

  </section>

  <section id="footer">
    <h2>By: Yezhen Chen, Abi Chinn, Chaeri Hong, Elijah Price, & Wyatt Stanley</h2>
    <h2>GEOG 458 Group AA1</h2>
  </section>


  <script>
    // 1. Declare the maps, script panels, and different thematic layers.
    let map, scriptPanel = scrollama(), ushospitalLayer, emsLayer;

    // 2. Intialize the layout.
   
    history.scrollRestoration = "manual"; // make sure the geo-narrative will be scrolled to the cover page even after a page refresh.
    window.scrollTo(0, 0); // scroll the geo-narrative to the coverpage
    adjustStoryboardlSize(); // force a browser window resize.
    window.addEventListener("resize", adjustStoryboardlSize); // // ask the browser window listen to the resize event, thereby force a viewport resize whenever adjusting the window size.

    // 3. Define Generic window resize listener event
    function adjustStoryboardlSize() {

      const scenes = document.getElementsByClassName("scene");
      const storyboard = document.getElementById("storyboard");

      // 3.1 determine the height of each scene element
      let sceneH = Math.floor(window.innerHeight * 0.75);
      for (const scene of scenes) {
        scene.style.height = sceneH + "px";
      }
      
      // 3.2 determin the height of the storyboard.
      let storyboardHeight = window.innerHeight;
      let storyboardMarginTop = (window.innerHeight - storyboardHeight) / 2;

      storyboard.style.height = storyboardHeight + "px";
      storyboard.style.top = storyboardMarginTop + "px"

      // 3.3 tell scrollama/script panel to update new element dimensions
      scriptPanel.resize();
    }

    // 4. Initialize the mapbox
    mapboxgl.accessToken =
      'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw'; // Assign the access token
   
    map = new mapboxgl.Map({
      container: 'map', // container ID
      style: 'mapbox://styles/mapbox/light-v10',
      zoom: 4, // starting zoom
      minZoom: 3,
      maxZoom: 15,
      center: [-109.4151140079552, 41.25017612415869], // starting center
      scrollZoom: false,
      boxZoom: false,
      doubleClickZoom: false
    });  // Declare the map object

    // An alternative way to disable map zoom when using scroll
    // map.scrollZoom.disable();


    // 5. define the asynchronous function to load geojson data and then performs the dependent actions.
    async function geojsonFetch() {

      // 6 wait till the data of washington counties and ems are fully loaded.
      let response, ushospital, minority;
      response = await fetch("assets/ushospital.geojson");
      ushospital = await response.json();

      // 7. Trigger operations inside of the the ()=> {} funciton while loading the map.
      map.on('load', () => {

        // ADDING CLICKABLE POINTS
        map.on('click', function(e) {
          // Get features at the clicked point
          var features = map.queryRenderedFeatures(e.point, { layers: ['ushospital-points'] });

          if (!features.length) {
              return;
          }

          var feature = features[0];

          // You can now access properties of the clicked feature and display them
          var popup = new mapboxgl.Popup()
              .setLngLat(feature.geometry.coordinates)
              .setHTML('<h3>' + feature.properties.NAME + '</h3><p>' + feature.properties.CITY + '</p>')
              .addTo(map);
        });

        // 8. add map source and declare layers.

        map.addSource('ushospital-src', {
          type: 'geojson',
          data: ushospital
        });

        ushospitalLayer = {
          'id': 'ushospital-points',
          'type': 'circle',
          'source': 'ushospital-src',
          'minzoom': 5,
          'paint': {
            'circle-color': 'red',
            'circle-radius': 4,
            'circle-opacity': 0.8,
          }
        };

        map.addSource('min-tiles', {
                'type': 'raster',
                'tiles': [
                    'assets/min/{z}/{x}/{y}.png'
                ],
                'tileSize': 256,
            });
        map.addLayer({
            'id': 'min',
            'type': 'raster',
            'layout': {
                'visibility': 'none'
            },
            'source': 'min-tiles'
        });


        map.addSource('countypop-tiles', {
                'type': 'raster',
                'tiles': [
                    'assets/countypop/{z}/{x}/{y}.png'
                ],
                'tileSize': 256,
        });
        map.addLayer({
            'id': 'countypop',
            'type': 'raster',
            'layout': {
                'visibility': 'none'
            },
            'source': 'countypop-tiles'
        });

        map.addSource('beds-tiles', {
                'type': 'raster',
                'tiles': [
                    'assets/beds/{z}/{x}/{y}.png'
                ],
                'tileSize': 256,
        });
        map.addLayer({
            'id': 'beds',
            'type': 'raster',
            'layout': {
                'visibility': 'none'
            },
            'source': 'beds-tiles'
        });

        // 9. Initialize the script panel
        scriptPanel
          .setup({
            step: ".scene", // all the scenes.
            offset: 0.33, // the location of the enter and exit trigger
            debug: false // toggler on or off the debug mode.
          })
          .onStepEnter(handleSceneEnter)
          .onStepExit(handleSceneExit);
        
        // 10. This function performs when a scene enters the storyboard
        function handleSceneEnter(response) {

          var index = response.index; 

          if (index === 0 || index === 3) { 
            map.flyTo({
                center: [-124.5, 40],
                zoom: 5,
                pitch: 30,
                speed: 0.5
            }); 
            
            if (typeof (map.getSource('ushospital-src')) == 'undefined') { 
                map.addSource('ushospital-src', {
                    type: 'geojson',
                    data: ushospital
                }); 
            } else {
                map.getSource('ushospital-src').setData(ushospital); 
            }

            if (!map.getLayer("ushospital-points")) { 
                map.addLayer(ushospitalLayer); 
            }

            if (index === 3) { 
            map.flyTo({
                center: [-122.3659068281188, 47.591669543756304],
                zoom: 10,
                pitch: 0,
                speed: 2
            }); 
            if (map.getLayer("min")) {
              map.setLayoutProperty("min", "visibility", "visible");
            }
          }
        
        } else if (index === 1) { 
            map.flyTo({
              center: [-122.32924428512132, 47.646212989022125],
              zoom: 7,
              pitch: 20,
              speed: 0.5

            });
            if (map.getLayer("countypop")) {
              map.setLayoutProperty("countypop", "visibility", "visible");
            }
          
          } else if (index === 2) {
            //Relocate to Seattle
            map.flyTo({
              center: [-122.32924428512132, 47.645212989022125],
              zoom: 7,
              pitch: 0,
              speed: 0.5
            });
            if (map.getLayer("beds")) {
              map.setLayoutProperty("beds", "visibility", "visible");
            }

          } 
          
        }

        // 11. This function performs when a scene exists the storyboard
        function handleSceneExit(response) {
          var index = response.index;

          if (index === 0 || index === 3) {
            if (map.getLayer("ushospital-points")) {
              map.removeLayer('ushospital-points');
            }
            if (response.direction == 'down') { 
              document.getElementById("cover").style.visibility = "hidden"; // when you scroll down, the cover page will be hided.
            } else {
              document.getElementById("cover").style.visibility = "visible"; // when you scroll up, the cover page will be shown.
            }
            if (index === 3 && map.getLayer("min")) {
            map.setLayoutProperty("min", "visibility", "none");
            }
          }
          if (index === 1 && map.getLayer("countypop")) {
            map.setLayoutProperty("countypop", "visibility", "none");
          }
          if (index === 2 && map.getLayer("beds")) {
            map.setLayoutProperty("beds", "visibility", "none");
          }
          
        }


      });

    };

    // 5 call the data loading function.
    geojsonFetch();
  </script>
</body>

</html>